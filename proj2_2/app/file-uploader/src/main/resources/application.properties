# =========================================================
# APPLICATION
# =========================================================
spring.application.name=file-uploader

# =========================================================
# SERVER
# =========================================================
server.port=${SERVER_PORT:8080}
server.shutdown=graceful

# =========================================================
# REACTIVE R2DBC (PostgreSQL) — RUNTIME
# =========================================================
spring.r2dbc.url=${SPRING_R2DBC_URL:r2dbc:postgresql://localhost:5432/filedb}
spring.r2dbc.username=${SPRING_R2DBC_USERNAME:postgres}
spring.r2dbc.password=${SPRING_R2DBC_PASSWORD:postgres}

# R2DBC Pool
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.initial-size=5
spring.r2dbc.pool.max-size=20
spring.r2dbc.pool.max-idle-time=30m
spring.r2dbc.pool.validation-query=SELECT 1

# =========================================================
# JDBC — ONLY FOR FLYWAY MIGRATIONS
# =========================================================
# =========================================================
# FLYWAY
# =========================================================
spring.flyway.enabled=true
spring.flyway.url=${SPRING_FLYWAY_URL:jdbc:postgresql://localhost:5432/filedb}
spring.flyway.user=${SPRING_FLYWAY_USERNAME:postgres}
spring.flyway.password=${SPRING_FLYWAY_PASSWORD:postgres}
spring.flyway.driver-class-name=org.postgresql.Driver
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

# =========================================================
# THYMELEAF (Reactive)
# =========================================================
spring.thymeleaf.cache=false
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML

# =========================================================
# LOGGING
# =========================================================
logging.level.root=${LOG_LEVEL:INFO}
logging.level.org.springframework.r2dbc=INFO
logging.level.io.r2dbc.postgresql=INFO
logging.level.org.flywaydb=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} %-5level %logger - %msg%n

# =========================================================
# ACTUATOR
# =========================================================
management.endpoints.web.exposure.include=${MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE:health,info}
management.endpoint.health.show-details=always
management.health.r2dbc.enabled=true

# =========================================================
# DEVTOOLS
# =========================================================
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=false

# =========================================================
# REACTIVE SERVER (NETTY)
# =========================================================
spring.codec.max-in-memory-size=10MB

# =========================================================
# FILE UPLOAD (future)
# =========================================================
spring.webflux.multipart.max-in-memory-size=10MB
spring.webflux.multipart.max-parts=50

# =========================================================
# REDIS
# =========================================================
spring.data.redis.host=${REDIS_HOST:redis.icod.kz}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:admin12345@}
spring.data.redis.database=${REDIS_DB:0}
spring.data.redis.timeout=${REDIS_TIMEOUT:3s}
spring.data.redis.connect-timeout=${REDIS_CONNECT_TIMEOUT:3s}

# =========================================================
# FILE PROCESSING LOCK
# =========================================================
app.processing-lock.ttl=${APP_PROCESSING_LOCK_TTL:PT5M}
app.processing-lock.key-prefix=${APP_PROCESSING_LOCK_KEY_PREFIX:file:processing:}

# =========================================================
# S3 STORAGE
# =========================================================
app.storage.endpoint=${S3_ENDPOINT:https://minio-s3.icod.kz}
app.storage.bucket=${S3_BUCKET:kaspi-lab-public}
app.storage.access-key=${S3_ACCESS_KEY:app}
app.storage.secret-key=${S3_SECRET_KEY:app12345@}
app.storage.region=${S3_REGION:us-east-1}
app.storage.path-style=${S3_PATH_STYLE:true}
app.storage.browser-base-url=${S3_BROWSER_BASE_URL:https://minio-ui.icod.kz/browser/kaspi-lab-public/}
